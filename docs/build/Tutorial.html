

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial &mdash; eNMRpy 0.0.2 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="PKG Info" href="pkginfo.html" />
    <link rel="prev" title="eNMR basics" href="eNMR basics.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> eNMRpy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="eNMR basics.html">eNMR basics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#importing-and-processing-the-enmr-spectrum">Importing and processing the eNMR spectrum</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#loading-the-data">loading the data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#processing-the-spectrum-fft-linebroadening">Processing the spectrum (FFT, linebroadening)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plotting-the-spectrum">Plotting the spectrum</a></li>
<li class="toctree-l3"><a class="reference internal" href="#important-instance-variables">Important instance variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#phase-analysis">Phase analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#approximation-of-lorentzian-shaped-function">Approximation of Lorentzian-shaped function</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#peak-picking">Peak picking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#peak-selection-via-gui">Peak selection via GUI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-the-fit-model-and-fitting-the-enmr-measurement">Creating the fit model and fitting the eNMR measurement</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#automatic-phase-correction">Automatic phase correction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mobility-ordered-spectroscopy-mosy">Mobility Ordered SpectroscopY MOSY</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#calculating-the-mobility-from-phase-data">Calculating the mobility from phase data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#analyzing-the-signal-intensity-after-phase-correction">Analyzing the signal intensity after phase correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#saving-and-importing-measurements">Saving and importing measurements</a><ul class="simple">
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pkginfo.html">PKG Info</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">eNMRpy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial">
<span id="tutorialpage"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>The following tutorial follows the typical work-flow analyzing an eNMR measurement.
Code marked with &gt;&gt;&gt; is input code, while all other lines are the respective output.</p>
<div class="section" id="importing-and-processing-the-enmr-spectrum">
<h2>Importing and processing the eNMR spectrum<a class="headerlink" href="#importing-and-processing-the-enmr-spectrum" title="Permalink to this headline">¶</a></h2>
<div class="section" id="loading-the-data">
<h3>loading the data<a class="headerlink" href="#loading-the-data" title="Permalink to this headline">¶</a></h3>
<p>Loading the eNMR data takes place by creating an instance (object) of the respective import class with the respective path and expno of the experiment. This is the most critical point when adapting a different experimental setup to eNMRpy. If you are in need for help, please consider a <a class="reference external" href="https://github.com/Flackermann/eNMRpy">pull request on GitHub</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">eNMRpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">eNMRpy</span><span class="o">.</span><span class="n">Import_eNMR_Measurement</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">expno</span><span class="p">,</span> <span class="n">dependency</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="n">lineb</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">2.2e-2</span><span class="p">,</span> <span class="n">cell_resistance</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="processing-the-spectrum-fft-linebroadening">
<h3>Processing the spectrum (FFT, linebroadening)<a class="headerlink" href="#processing-the-spectrum-fft-linebroadening" title="Permalink to this headline">¶</a></h3>
<p>Usually, the imported data represents the free induction decay (FID), recorded for the eNMR measurements.
In order to analyze the eNMR measurement, the FID needs to be transformed into a spectrum via Fast Fourier
Transformation (FFT) via the .proc() method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">proc</span><span class="p">(</span><span class="n">linebroadening</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phc0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">phc1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>This method transforms the self.data array from the FID to the spectrum. phc0 and phc1 give the zero and first order phase correction. If xmin and/or xmin are not None, self.set_spectral_region() will be called with the given limits.</p>
<p><strong>Note:</strong> Please keep in mind, that self.data is changed. It should always be used directly after loading the raw data. Therefore, it is good practice to write self.proc() in the same cell within a jupyter notebook, in order to obtain the correct spectrum after each execution of the respective cell.</p>
</div>
<div class="section" id="plotting-the-spectrum">
<h3>Plotting the spectrum<a class="headerlink" href="#plotting-the-spectrum" title="Permalink to this headline">¶</a></h3>
<p>After loading the raw data, and processing the spectrum, we want to have a look at the result by plotting the spectrum via the method self.plot_spec(). This method returns a matplotlib figure, <a class="reference external" href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.figure.html">which can be used as usual</a>. The first argument in self.plot_spec() can be an integer or an array of integers, in order to plot multiple rows of the 2D spectrum on top of each other.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fullspec</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">plot_spec</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="important-instance-variables">
<h3>Important instance variables<a class="headerlink" href="#important-instance-variables" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">important instance variables of the measurement object (in this example <strong>m</strong>) from the .Pavel()-class <em>(atm standard import class)</em></span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>variable</p></th>
<th class="head"><p>meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>self.eNMRraw</p></td>
<td><p>contains the phase data, voltage list, and gradient list
data for all eNMR experiments</p></td>
</tr>
<tr class="row-odd"><td><p>self.d</p></td>
<td><p>electrode distance in m (cell constant)</p></td>
</tr>
<tr class="row-even"><td><p>self.Delta</p></td>
<td><p>observation time in s</p></td>
</tr>
<tr class="row-odd"><td><p>self.delta</p></td>
<td><p>magnetic field gradient pulse duration</p></td>
</tr>
<tr class="row-even"><td><p>self.gamma</p></td>
<td><p>gyromagnetic ratio in °/Ts</p></td>
</tr>
<tr class="row-odd"><td><p>self.path</p></td>
<td><p>path used to import the data</p></td>
</tr>
<tr class="row-even"><td><p>self.expno</p></td>
<td><p>experiment number according to Bruker’s syntax</p></td>
</tr>
<tr class="row-odd"><td><p>self.lineb</p></td>
<td><p>line broadening variable used for processing</p></td>
</tr>
<tr class="row-even"><td><p>self.ppm</p></td>
<td><p>list of chemical shift for each datapoint</p></td>
</tr>
<tr class="row-odd"><td><p>self.data</p></td>
<td><p>2D numpy array containing the complex spectral data</p></td>
</tr>
<tr class="row-even"><td><p>self.nuc</p></td>
<td><p>investigated nucleus</p></td>
</tr>
<tr class="row-odd"><td><p>self.title_page</p></td>
<td><p>imported title page from bruker file -&gt; transformed to be used with print</p></td>
</tr>
<tr class="row-even"><td><p>self.dependency</p></td>
<td><p>voltage, gradient, or current dependent measurement –&gt; see docstring</p></td>
</tr>
<tr class="row-odd"><td><p>self.cell_resistance</p></td>
<td><p>important to calculate the electric field when const. <em>I</em> mode is used</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="phase-analysis">
<h2>Phase analysis<a class="headerlink" href="#phase-analysis" title="Permalink to this headline">¶</a></h2>
<p>eNMRpy comes with three different methods for the determination of the electrophoretic mobility.
a) <a class="reference internal" href="#lorentzpage"><span class="std std-ref">Fitting of Lorentzians</span></a>, b) <a class="reference internal" href="#autophasepage"><span class="std std-ref">automatic phase correction</span></a>, and c) <a class="reference internal" href="#mosypage"><span class="std std-ref">Mobility Ordered SpectroscopY (MOSY)</span></a>.
A brief description of all these methods can be found in the linked <a class="reference external" href="https://onlinelibrary.wiley.com/doi/full/10.1002/mrc.4978">open access article</a> published in <em>Magnetic Resonance in Chemistry</em> by Wiley.</p>
<div class="section" id="approximation-of-lorentzian-shaped-function">
<span id="lorentzpage"></span><h3>Approximation of Lorentzian-shaped function<a class="headerlink" href="#approximation-of-lorentzian-shaped-function" title="Permalink to this headline">¶</a></h3>
<p>In order to analyze the phase shift via the approximation of Lorentzian shaped profiles, one has to import the submodule <em>Phasefitting</em> accordingly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">eNMRpy</span> <span class="kn">import</span> <span class="n">Phasefitting</span> <span class="k">as</span> <span class="n">phf</span>
</pre></div>
</div>
<p>Two methods exist for the creation of the <a class="reference external" href="https://github.com/lmfit/lmfit-py">lmfit</a> fit model.</p>
<div class="section" id="peak-picking">
<h4>Peak picking<a class="headerlink" href="#peak-picking" title="Permalink to this headline">¶</a></h4>
<p>The first model uses the peakpicker() function contained in the Phasefitting module to obtain an array (in this example <em>peaks</em>) listing the peaks picked. The peakpicker() function needs the x-coordinate (<em>m.ppm</em>) and y-coordinate (here the first spectral row <em>m.data[0]</em> of the measurement object <em>m</em>), and a threshold below which no peak is picked:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">peaks</span> <span class="o">=</span> <span class="n">phf</span><span class="o">.</span><span class="n">peakpicker</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">ppm</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1e5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="peak-selection-via-gui">
<h4>Peak selection via GUI<a class="headerlink" href="#peak-selection-via-gui" title="Permalink to this headline">¶</a></h4>
<p>Since the peak picking approach is not always reliable, one can use a GUI for the selection of the individual peaks.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="o">%</span><span class="n">matplotlib</span>  <span class="n">qt5</span>          <span class="c1"># enables matplotlib to open a GUI outside of the jupyter notebook</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">peaks</span> <span class="o">=</span> <span class="n">phf</span><span class="o">.</span><span class="n">set_peaks</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>  <span class="c1"># starts the GUI</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>        <span class="c1"># returns to the inline-plotting mode for the jupyter notebook</span>
</pre></div>
</div>
<p>Peaks are selected by a left-click, the last peak can be deleted via a right-click. <strong>Note:</strong> that the red crosses correspond to the clicking points, where the peaks were selected. This is important for estimating the peak’s amplitude. <strong>Note:</strong> It is important to close the GUI by either clicking the middle bouse button, or pressing &lt;enter&gt; on the keyboard. Otherwise, the jupyter notebook may be stuck in a while loop.</p>
<a class="reference internal image-reference" href="_images/peakpickerGUI.png"><img alt="set_peaks() GUI" src="_images/peakpickerGUI.png" style="width: 600px;" /></a>
</div>
<div class="section" id="creating-the-fit-model-and-fitting-the-enmr-measurement">
<h4>Creating the fit model and fitting the eNMR measurement<a class="headerlink" href="#creating-the-fit-model-and-fitting-the-enmr-measurement" title="Permalink to this headline">¶</a></h4>
<p>The <em>peaks</em> array, obtained via one of the two methods described above, is then passed to the <em>make_model()</em> wrapper function, returning an instance of the lmfit.Model()-class (named <em>model</em> in this example) including the correct parameters set, and Lorentzian function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">phf</span><span class="o">.</span><span class="n">make_model</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">print_params</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>A key aspect of the fitting method is to introduce physically meaningful restrictions to the fitmodel by defining dependencies between parameters. The most straightforward restriction is to set signal phases corresponding to the same molecule equal by using the method self.set_mathematical_constraints(). In this example, <em>ph0 = ph1 = ph2</em> hence, only <em>ph2</em> is varied in the following fit. (see self.params.pretty_print())</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">set_mathematical_constraints</span><span class="p">([</span><span class="s1">&#39;ph0=ph1&#39;</span><span class="p">,</span> <span class="s1">&#39;ph1=ph2&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The set of parameter can be investigated via:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
<span class="go">Name         Value      Min      Max   Stderr     Vary     Expr Brute_Step</span>
<span class="go">a0        2.107e+04        0      inf     None     True     None     None</span>
<span class="go">a1        1.927e+04        0      inf     None     True     None     None</span>
<span class="go">a2        1.867e+04        0      inf     None     True     None     None</span>
<span class="go">baseline         1     -inf      inf     None     True     None     None</span>
<span class="go">l0            0.01        0      inf     None     True     None     None</span>
<span class="go">l1            0.01        0      inf     None     True     None     None</span>
<span class="go">l2            0.01        0      inf     None     True     None     None</span>
<span class="go">ph0              1     -180      180     None    False      ph1     None</span>
<span class="go">ph1              1     -180      180     None    False      ph2     None</span>
<span class="go">ph2              1     -180      180     None     True     None     None</span>
<span class="go">v0           4.985     -inf      inf     None     True     None     None</span>
<span class="go">v1           5.063     -inf      inf     None     True     None     None</span>
<span class="go">v2           6.137     -inf      inf     None     True     None     None</span>
</pre></div>
</div>
<p>Furthermore, it is possible to <a class="reference external" href="https://lmfit.github.io/lmfit-py/parameters.html">manipulate single parameters</a> according to the documentation of the lmfit package.</p>
<p>The initial spectrum can be plotted via model.plot_init_spec(), which takes the x-coordinate <em>m.ppm</em> and as an optional argument the 1D figure <em>fullspec</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fullspec</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">plot_spec</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">plot_init_spec</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">ppm</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fullspec</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/init_spec.png"><img alt="spectrum with initial fit parameters" src="_images/init_spec.png" style="width: 600px;" /></a>
<p>In order to see, whether the initial parameters are well-chosen resulting in a converging fit, a test-fit of the first spectrum can be achieved using the self.fit() method of the fit-model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">ppm</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/testfit.png"><img alt="test fit of the fist spectrum" src="_images/testfit.png" style="width: 400px;" /></a>
<p>In order to fit a whole eNMR measurement, the function Phasefitting.fit_Measurement() is used inserting the measurement object <em>m</em>, and the fit model <em>model</em>. Using this function, all eNMR spectra in <em>m</em> are fitted consecutively, and the results are stored in the <em>m.eNMRraw</em> pandas-DataFrame.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">phf</span><span class="o">.</span><span class="n">fit_Measurement</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parse_complex</span><span class="o">=</span><span class="s1">&#39;real&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The results of the fit can be found in the measurement objects eNMRraw pandas DataFrame. In this example <em>m.eNMRraw</em>.</p>
</div>
</div>
<div class="section" id="automatic-phase-correction">
<span id="autophasepage"></span><h3>Automatic phase correction<a class="headerlink" href="#automatic-phase-correction" title="Permalink to this headline">¶</a></h3>
<p>A simple way to analyze the phase shift is the analysis via zero order phase correction. Here, a very straight forward phase correction algorithm described <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S1090780702000691">earlier</a> is employed. The implementation of this method <a class="reference external" href="https://nmrglue.readthedocs.io/en/latest/reference/proc_autophase.html">was adapted from the nmrglue package</a> and altered in order to match the scope of this work.</p>
<p>The method self.autophase_phase_analysis() is executed, and automatically starts the analysis while storing the results in the self.eNMRraw pandas-DataFrame in the “ph0acme” column.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">autophase_phase_analysis</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Note:</strong> This method is a quick analysis which is only applicable to spectra exhibiting resonances of a single substance, where no superposition of signals with different phase shifts is expected.</p>
</div>
<div class="section" id="mobility-ordered-spectroscopy-mosy">
<span id="mosypage"></span><h3>Mobility Ordered SpectroscopY MOSY<a class="headerlink" href="#mobility-ordered-spectroscopy-mosy" title="Permalink to this headline">¶</a></h3>
<p>MOSY is a 2D Fouriertransformation-based technique for the analysis of the electrophoretic mobility <span class="math notranslate nohighlight">\(\mu\)</span>, where the signal intensity is described via</p>
<div class="math notranslate nohighlight">
\[S(\omega) = S_0 \left[ A(\omega) + iD(\omega) \right] \left[ \cos(\gamma \delta \varDelta G \mu E) + i \sin(\gamma \delta \varDelta G \mu E) \right]\]</div>
<p>In order to perform the fourier transformation, the module MOSY has to be imported, the <em>mosy</em> object is created from the MOSY.MOSY()-class, and processed via the self.calc_MOSY()-method</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">eNMRpy</span> <span class="kn">import</span> <span class="n">MOSY</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mosy</span> <span class="o">=</span> <span class="n">MOSY</span><span class="o">.</span><span class="n">MOSY</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mosy</span><span class="o">.</span><span class="n">calc_MOSY</span><span class="p">()</span>
<span class="go">zero filling started!</span>
<span class="go">(11, 1967) (4096, 1967)</span>
<span class="go">zero filling finished!</span>
<span class="go">done</span>
</pre></div>
</div>
<p>In order to view the result, the method self.plot_MOSY() can be used returning a matplotlib figure named <em>mosyfig</em> in this example. <strong>Note:</strong> The xlim is set in from high to low values, as it is common in NMR spectroscopy.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mosyfig</span> <span class="o">=</span> <span class="n">mosy</span><span class="o">.</span><span class="n">plot_MOSY</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<p>This plot results in the following figure showing the full spectrum, including truncation artifacts etc.:</p>
<a class="reference internal image-reference" href="_images/mosyunscaled.png"><img alt="raw mosy spectrum" src="_images/mosyunscaled.png" style="width: 400px;" /></a>
<p>In order to clean up the MOSY spectrum, one can rescale the figure accordingly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">zoom</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">base</span> <span class="o">=</span> <span class="mf">1.39</span> <span class="c1">#changes the distance of the lines -- base of the exponential term</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">number_of_lines</span> <span class="o">=</span> <span class="mi">10</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">mosyfig</span> <span class="o">=</span> <span class="n">mosy</span><span class="o">.</span><span class="n">plot_MOSY</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">4.6</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5e-9</span><span class="p">,</span> <span class="mf">2.5e-9</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
<span class="gp">&gt;&gt;&gt; </span>                         <span class="n">levels</span><span class="o">=</span><span class="n">zoom</span><span class="o">*</span><span class="n">base</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">number_of_lines</span><span class="p">))</span>
</pre></div>
</div>
<p>Leading to the following figure:</p>
<a class="reference internal image-reference" href="_images/mosy_scaled.png"><img alt="rescaled mosy spectrum" src="_images/mosy_scaled.png" style="width: 600px;" /></a>
<p>In order to determine the position of the peaks, and therefore the mobility, it is recommended to plot slices in the mobility domain of the peaks on top of each other.
For this reason, a list containing the chemical shifts of the peaks is necessary. This list can either be created manually, or by using the automatic peakpicker tool, or the GUI explained above.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">eNMRpy.Phasefitting</span> <span class="kn">import</span> <span class="n">peakpicker</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">peaks</span> <span class="o">=</span> <span class="n">peakpicker</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">ppm</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># list of peaks with [[ppm, intensity],..].</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">slices_ppm</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>              <span class="c1"># Only chemical shifts are returned from peaks via peaks[:,0]</span>
</pre></div>
</div>
<p>The figure containing the MOSY slices is then created via the self.plot_slices_F1() method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mosyslicefig</span> <span class="o">=</span> <span class="n">mosy</span><span class="o">.</span><span class="n">plot_slices_F1</span><span class="p">(</span><span class="n">slices_ppm</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/mosyslicefig.png"><img alt="raw slices of mosy spectrum" src="_images/mosyslicefig.png" style="width: 600px;" /></a>
<p>This figure shows the strong sync-modulation originating from a truncated FID and FFT in the mobility dimension. Rescaling the image, and autopicking and annotating the peaks with their respective mobility yields the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mosyslicefig</span> <span class="o">=</span> <span class="n">mosy</span><span class="o">.</span><span class="n">plot_slices_F1</span><span class="p">(</span><span class="n">peaks</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span> <span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5e-9</span><span class="p">,</span> <span class="mf">2.5e-9</span><span class="p">)</span> <span class="p">,</span><span class="n">annotate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/mosyslicefig_annotated.png"><img alt="rescaled and annotated slices of mosy spectrum" src="_images/mosyslicefig_annotated.png" style="width: 600px;" /></a>
<p><strong>Note:</strong> Even though the mobilities of all three peaks do not completely agree, this may be the case due to an insufficient digitization of the peak, which may be corrected by a higher zerofilling in self.calc_MOSY(), but also shows the limitations of MOSY analysis on substances exhibiting only a small phase shift range. It is however very helpful for complex spectra with large phase shift-ranges and a multitude of components with different mobilities, and also has the capability to resolve a superposition of two or more mobilities modulating a single NMR resonance.</p>
</div>
</div>
<div class="section" id="calculating-the-mobility-from-phase-data">
<h2>Calculating the mobility from phase data<a class="headerlink" href="#calculating-the-mobility-from-phase-data" title="Permalink to this headline">¶</a></h2>
<p>In order to calculate the mobility, a linear regression has to be performed on the phase data in the eNMR measurement object, here <em>m</em>.
For this reason, the method self.lin_huber() is used as a robust lin. regression method using the least squares approach with a threshold <em>epsilon</em>, looking for outliers.
Here, it is reasonable to set the threshold to 3, in order to include all data points assuming a large scattering of the phase values. Data points which are excluded from the linear regression are depicted as red dots when using <em>self.lin_display()</em>.
<em>y_column</em> sets the variable to be fitted and displayed. The phase variables from the fit model are named <em>ph0, ph1, ph2, […]</em>, while the phase variable originating from the autophase method is named <em>ph0acme</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">lin_huber</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y_column</span><span class="o">=</span><span class="s1">&#39;ph0&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">lin_display</span><span class="p">(</span><span class="n">y_column</span><span class="o">=</span><span class="s1">&#39;ph0&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/linearreg.png"><img alt="display of the linear regression" src="_images/linearreg.png" style="width: 400px;" /></a>
<p>Consecutively, the mobility can be determined. Note that the electrode_distance is crucial for the calculation of the mobility. If not altered, the standard value of 2.2e-2 meters will be taken.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">mobility</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mobility</span><span class="p">(</span><span class="n">y_column</span><span class="o">=</span><span class="s1">&#39;ph0&#39;</span><span class="p">)</span>
<span class="go">1.38E-09 (m^2/Vs) +- 6.45E-11</span>
</pre></div>
</div>
<p>In order to display multiple fitted phases on top of each other use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">comparephasefig</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">lin_results_display</span><span class="p">([</span><span class="s1">&#39;ph0&#39;</span><span class="p">,</span> <span class="s1">&#39;ph0acme&#39;</span><span class="p">])</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/phasecomparison.png"><img alt="comparison of fitted phase and autocorrected phase" src="_images/phasecomparison.png" style="width: 600px;" /></a>
</div>
<div class="section" id="analyzing-the-signal-intensity-after-phase-correction">
<h2>Analyzing the signal intensity after phase correction<a class="headerlink" href="#analyzing-the-signal-intensity-after-phase-correction" title="Permalink to this headline">¶</a></h2>
<p>In order to identify possible experimental artifacts, the evolution of the signal intensity can be investigated by correcting all spectra for their determined signal phase, making them fully absorptive, and consecutive integration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">intensityfig</span><span class="p">,</span> <span class="n">integrationresults</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">analyze_intensity</span><span class="p">(</span><span class="n">ph_var</span><span class="o">=</span><span class="s1">&#39;ph0&#39;</span><span class="p">)</span>

<span class="go">         U  intensity         ph</span>
<span class="go"> 0     0.0   1.000000 -13.653589</span>
<span class="go"> 1   -60.0   0.778901 -22.025162</span>
<span class="go"> 2    60.0   0.758279   0.597989</span>
<span class="go"> 3   -30.0   0.807881 -18.331584</span>
<span class="go"> 4    30.0   0.948111  -6.251822</span>
<span class="go"> 5   -50.0   0.748151 -21.568244</span>
<span class="go"> 6    50.0   0.711298  -5.904790</span>
<span class="go"> 7   -40.0   0.942212 -15.254777</span>
<span class="go"> 8    40.0   0.823194  -6.118121</span>
<span class="go"> 9  -100.0   0.595154 -30.651999</span>
<span class="go"> 10  100.0   0.499146  12.829012</span>
<span class="go"> 11  -20.0   0.940226 -14.515923</span>
<span class="go"> 12   70.0   0.579074  -1.227382</span>
<span class="go"> 13  -70.0   0.639213 -26.243095</span>
<span class="go"> 14   20.0   0.881509 -11.049295</span>
<span class="go"> 15  -80.0   0.657257 -26.869181</span>
<span class="go"> 16   80.0   0.533540   1.642832</span>
<span class="go"> 17  -10.0   0.965522 -13.948664</span>
<span class="go"> 18   90.0   0.537945   8.729907</span>
<span class="go"> 19  -90.0   0.585712 -29.861292</span>
<span class="go"> 20   10.0   0.866894 -13.439502</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/intensityfig.png"><img alt="intensity figure" src="_images/intensityfig.png" style="width: 600px;" /></a>
</div>
<div class="section" id="saving-and-importing-measurements">
<h2>Saving and importing measurements<a class="headerlink" href="#saving-and-importing-measurements" title="Permalink to this headline">¶</a></h2>
<p>After evaluating an eNMR measurement, the spectral data and phase results can be stored in a .eNMRpy file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">save_eNMRpy</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to save only the self.eNMRraw table in excel format, use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">eNMRraw</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<p>Loading past results works this way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">eNMRpy</span> <span class="kn">import</span> <span class="n">tools</span>

<span class="n">m_imported</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Load_eNMRpy_data</span><span class="p">(</span><span class="s1">&#39;measurement_test.eNMRpy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The loaded results can be used in almost any way, as its original measurement object. This way of loading measurements is intended to archive several evaluation versions of the same or different measurements, and load them at some time in the future for comparison or plotting reasons.</p>
<div class="toctree-wrapper compound">
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pkginfo.html" class="btn btn-neutral float-right" title="PKG Info" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="eNMR basics.html" class="btn btn-neutral float-left" title="eNMR basics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Florian Ackermann

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>